apiVersion: v1
kind: Service
metadata:
  name: vworkspace-app
  labels:
    app: vworkspace
    role: app
spec:
  type: NodePort
  selector:
    app: vworkspace
    role: app
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
      nodePort: 30008

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: vworkspace-app
  labels:
    app: vworkspace
    role: app
spec:
  metadata:
    name: vworkspace-app
    labels:
      app: vworkspace
      role: app
  spec:
    containers:
      - name: nextcloud
        image: nextcloud:21.0.2-fpm-alpine
        env:
          - name: MYSQL_DATABASE
            value: nextcloud
          - name: MYSQL_USER
            value: root
          - name: MYSQL_PASSWORD
            value: 'test123'
          - name: MYSQL_HOST
            value: vworkspace-db
          - name: REDIS_HOST
            value: 'vworkspace-redis'
          - name: REDIS_HOST_PORT
            value: '6379'
        volumeMounts:
          - name: vworkspace-data
            mountPath: /var/www/html/data
          # - mountPath: /var/www/html/theme
          #   name: vworkspace-theme
          - name: vworkspace-custom-app
            mountPath: /var/www/html/custom_apps
          - name: vworkspace-config
            mountPath: /var/www/html/config
    volume:
      - name: vworkspace-data
        hostPath: 
          path: /mnt/voffice/data
      # - name: vworkspace-theme
      #   hostPath: 
      #     path: mnt/voffice/theme
      - name: vworkspace-custom-app
        hostPath: 
          path: /mnt/voffice/custom_apps
      - name: vworkspace-config
        hostPath: 
          path: /mnt/voffice/config